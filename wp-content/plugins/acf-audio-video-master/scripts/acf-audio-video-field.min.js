!function(e){function t(r){if(i[r])return i[r].exports;var a=i[r]={exports:{},id:r,loaded:!1};return e[r].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},s=i(1),o=r(s),l=jQuery;acf.fields.audioVideo=acf.field.extend({type:"audioVideo",$el:null,actions:{ready:"initialize",append:"initialize"},events:{'click a[data-name="add"]':"add",'click a[data-name="edit"]':"edit",'click a[data-name="remove"]':"remove"},focus:function(){this.$el=this.$field.find(".acf-audio-video-uploader"),this.$inputContainer=this.$el.find(".acf-hidden"),this.$playerContainer=this.$el.find(".player-container"),this.o=acf.get_data(this.$el),this.allowedTypes=this.o.allowed_types.split(",").map(function(e){return e.trim()}),this.selectFrameType=this.o.general_type&&"both"!=this.o.general_type?this.o.general_type:["audio","video"],this.inputName=this.__getInputName()},__getInputName:function(){return this.$inputContainer.children(":first").attr("name")},initialize:function(){},__getTag:function(e){return"undefined"==typeof e?this.o.general_type:this.o.general_type&&"both"!==this.o.general_type?this.o.general_type:this.__guessTag(e)},__guessTag:function(e){for(var t=0;t<this.allowedTypes.length;t++)if(e[this.allowedTypes[t]])return this.o.audio_types.indexOf(this.allowedTypes[t])>-1?"audio":"video";return"video"},render:function(e){var t=this,i=e.tag,r=e.nextAttributes,a=e.prevAttributes,n=i&&void 0!=i?this.__getSources(i,r):[];if(this.$playerContainer.empty().removeClass("audio video"),this.$inputContainer.empty(),n.length){var s=this.$playerContainer.addClass(i).html(this.__getPlayerMarkup(i,r,n)).find(i);new MediaElementPlayer(s[0]),Object.keys(r).forEach(function(e){return t.__insertHiddenInput(e,r[e])}),this.$el.addClass("has-value")}else this.__insertHiddenInput(),this.$el.removeClass("has-value");this.__triggerChange(a,r)},__getSources:function(e,t){var i=this;return this.allowedTypes.reduce(function(r,a){return t[a]?r.concat({type:i.__getMime(e,a),src:t[a]}):r},[])},__getMime:function(e,t){switch(t){case"mp3":return"audio/mpeg";case"wav":return"audio/wav";case"mp4":case"m4v":return"video/mp4";case"webm":return"video/webm";case"ogv":return"video/ogg";case"ogg":return e+"/ogg";case"flv":return"video/flv";default:return e+"/"+t}},__getPlayerMarkup:function(e,t,i){var r=this.__getTagAtts(e,t),a="video"==e?'height="360"':"";return'<div class="wp-'+e+"\">\n      <!--[if lt IE 9]><script>document.createElement('"+e+"');</script><![endif]-->\n      <"+e+' class="wp-'+e+'-shortcode" width="640" '+a+" "+r+" controls>\n        "+i.map(function(e){var t=e.type,i=e.src;return'<source type="'+t+'" src="'+i+'?_=1"/>'})+"\n      </"+e+">\n    </div>"},__getTagAtts:function(e,t){var i=this.o.playerDefaults[e];return Object.keys(i).concat("poster").reduce(function(e,i){return t.hasOwnProperty(i)?e+" "+i+'="'+t[i]+'"':e},"")},__insertHiddenInput:function(e,t){var i=this.$field.data(),r=(i.key,e?this.inputName+"["+e+"]":this.inputName);l('<input type="hidden">').attr({name:r,value:t}).appendTo(this.$inputContainer)},__triggerChange:function(e,t){e&&_.isEqual(e,t)||this.$inputContainer.children(":first").trigger("change")},add:function(){var e=this,t=this.$field,i=acf.get_closest_field(t,"repeater"),r=i.exists();this.selectFrame=new o.default({title:acf._e("audioVideo","select"),mode:"select",type:this.selectFrameType,field:t.data("key"),multiple:r,library:this.o.library,mime_types:this.o.allowed_types,select:function(n,s){var o=r&&t.closest(".acf-row");if(s>0){var u=t.data("key");if(t=!1,o.nextAll(".acf-row:visible").each(function(e,i){if(t=acf.get_field(u,l(i)))return!!t.find(".acf-file-uploader.has-value").exists()&&void(t=!1)}),!t){if(o=acf.fields.repeater.doFocus(i).add(),!o)return!1;t=acf.get_field(u,o)}}var d=n.attributes.url.toLowerCase().split(".").pop(),c=a({},d,n.attributes.url),f=e.__getTag(c);n.attributes.image&&n.attributes.image.src&&!/wp-includes\/images\/media\/(audio|video).png$/.test(n.attributes.image.src)&&(c.poster=n.attributes.image.src);var p={tag:f,nextAttributes:c};e.set("$field",t).render(p)}}).open()},edit:function(){var e=this,t=this.__getAttributesFromInputs(),i=this.__getTag(t),r=this.__getShortcode(i,t);if(r){var a=wp.media[i].edit(r).open();a.on("close",function(){var r=e.__getNextAttributes(i,a.media.attributes),n=(acf.get_closest_field(e.$field,"repeater"),{tag:i,nextAttributes:r,prevAttributes:t});e.render(n),a.detach()})}},__getAttributesFromInputs:function(){return this.$inputContainer.children().toArray().reduce(function(e,t){var i=t.getAttribute("name").replace(/.*\[(.*)\]$/,"$1"),r=t.getAttribute("value");return n({},e,a({},i,r))},{})},__getShortcode:function(e,t){var i=Object.keys(t).reduce(function(e,i){return e+" "+i+'="'+t[i]+'"'},"");return i&&"["+e+" "+i+"][/"+e+"]"},__getNextAttributes:function(e,t){var i=this.o.playerDefaults[e],r={};return t.poster&&(r.poster=t.poster),Object.keys(i).forEach(function(e){t[e]!=i[e]&&(r[e]=t[e])}),this.allowedTypes.forEach(function(e){t[e]&&(r[e]=t[e])}),r},remove:function(){this.render({})}}),Object.keys(acf.fields.audioVideo).forEach(function(e){/^__/.test(e)&&(acf.fields.audioVideo[e]=acf.fields.audioVideo[e].bind(acf.fields.audioVideo))})},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},a=jQuery,n=function e(t){var n=this;i(this,e),this.createFrame=function(){var e=acf.media._get_media_frame_settings({title:n.settings.title,multiple:n.settings.multiple,library:{},states:[]},n.settings);n.settings.hasOwnProperty("mime_types")&&(e.library.type=n._getLibraryTypes());var t=wp.media.query(e.library);acf.isset(t,"mirroring","args")&&(t.mirroring.args._acfuploader=n.settings.field),e.states=[new wp.media.controller.Library({library:t,multiple:e.multiple,title:e.title,priority:20,filterable:"all",editable:!0,allowLocalEdits:!0})],acf.isset(wp,"media","controller","EditImage")&&e.states.push(new wp.media.controller.EditImage),n.frame=wp.media(e),n.frame.uploader.options.uploader.params.allowed_extensions=n.settings.mime_types,n.frame.acf=n.settings,n.addEvents(),n.frame=acf.media._add_media_frame_events(n.frame,n.settings)},this.addEvents=function(){n.frame.on("content:activate:browse",function(){var e=n.frame.content.get().toolbar,t=e.get("filters");t.filters.all.text=acf._e("audioVideo","all"),delete t.filters.uploaded,delete t.filters.audio,delete t.filters.video,delete t.filters.image,a.each(t.filters,function(e,t){null===t.props.type&&(t.props.type=n.settings.type)})})},this.open=function(){return setTimeout(function(){return n.frame.open()}),n},this._getLibraryTypes=function(){var e=n.settings.mime_types.split(",").map(function(e){return e.trim()}),t=n.settings.type instanceof String?n.settings.type:"video",i=e.map(function(e){return acf.fields.audioVideo.__getMime(t,e)});return n.settings.type instanceof Array&&e.indexOf("ogg")>-1&&i.push("audio/ogg"),i};var s=acf.get("post_id");return a.isNumeric(s)||(s=0),this.settings=r({mode:"select",title:"",button:"",type:"",field:"",mime_types:"",library:"all",multiple:!1,attachment:0,post_id:s,select:function(){}},t),this.settings.id&&(this.settings.attachment=this.settings.id),this.createFrame(),acf.media.frames.push(this.frame),this};t.default=n}]);
//# sourceMappingURL=acf-audio-video-field.min.js.map